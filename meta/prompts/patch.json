{
  "task": "Align synesthetic-labs to spec v0.1",
  "objective": "Patch Labs so that it conforms fully to labs_spec.md v0.1. Remove divergences noted in the last audit.",
  "changes": [
    {
      "id": "mcp_stdio_adapter",
      "description": "Replace TCP SocketMCPValidator with STDIO JSON-RPC client",
      "edits": [
        "Remove labs/cli.py: SocketMCPValidator + TCP logic",
        "Add labs/mcp_stdio.py: spawn MCP via subprocess, send NDJSON over stdin/stdout",
        "Wire CriticAgent to use StdioMCPValidator as default",
        "Update labs/cli.py CLI commands to fail if MCP process not available"
      ]
    },
    {
      "id": "defer_modulation_rule",
      "description": "Remove modulation and rule bundle generators from v0.1 scope",
      "edits": [
        "Move labs/generator/modulation.py and labs/generator/rule_bundle.py into labs/experimental/",
        "Strip references from labs/generator/assembler.py so only shader/tone/haptic/controls remain",
        "Update docs/labs_spec.md to confirm modulation/rule deferred to v0.2+"
      ]
    },
    {
      "id": "docs_sync",
      "description": "Sync documentation with patched state",
      "edits": [
        "Update docs/labs_spec.md transport section to require STDIO (no TCP)",
        "Update README.md to show MCP STDIO integration and remove TCP host/port examples",
        "Add note that modulation/rule are deferred to v0.2+"
      ]
    },
    {
      "id": "tests_update",
      "description": "Fix and extend tests after removing divergences",
      "edits": [
        "Remove or adapt tests/test_pipeline.py lines expecting TCP MCP_HOST/PORT env vars",
        "Add regression test: Critic fails fast if MCP STDIO unavailable",
        "Remove tests that depend on modulation/rule generation for v0.1"
      ]
    }
  ],
  "constraints": {
    "rules": [
      "No new dependencies beyond stdlib",
      "Must use subprocess.Popen for STDIO bridge",
      "Tests must pass after patch",
      "Docs and README must be consistent with code"
    ]
  },
  "exit_criteria": [
    "All MCP calls in Labs go over STDIO, no TCP left",
    "Modulation/rule generation removed from v0.1 flow",
    "docs/labs_spec.md and README.md aligned with new implementation",
    "Audit passes with no divergences"
  ]
}

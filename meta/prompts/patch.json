{
  "task": "Close remaining Synesthetic Labs v0.3.3 audit gaps",
  "objective": "Align runtime, env, and docs with v0.3.3 spec. Add deprecation warning for SYN_SCHEMAS_DIR, mark it deprecated in .env, and reference resolver fallback in maintainer docs.",
  "changes": [
    {
      "id": "schemas_dir_warning",
      "description": "Emit deprecation warning when SYN_SCHEMAS_DIR is forwarded under STDIO.",
      "edits": [
        {
          "file": "labs/mcp_stdio.py",
          "pattern": "if schemas_dir:",
          "multiple": false,
          "replacement": "if schemas_dir:\n        import sys\n        import logging\n        logging.warning(\"SYN_SCHEMAS_DIR is deprecated and only supported for STDIO; will be removed in a future release.\")"
        }
      ]
    },
    {
      "id": "env_cleanup",
      "description": "Update .env sample so SYN_SCHEMAS_DIR is marked deprecated and STDIO-only.",
      "edits": [
        {
          "file": ".env",
          "pattern": "SYN_SCHEMAS_DIR=.*",
          "multiple": true,
          "replacement": "# Deprecated: Only used for STDIO adapter; avoid in new setups\n# SYN_SCHEMAS_DIR=/abs/path/to/schemas"
        }
      ]
    },
    {
      "id": "maintainer_docs_resolver",
      "description": "Add explicit reference to resolve_mcp_endpoint in maintainer docs for provenance clarity.",
      "edits": [
        {
          "file": "docs/process.md",
          "pattern": ".*",
          "multiple": true,
          "replacement": "# Synesthetic Labs Maintainer Process\n\n## Transport Provenance\n\nLabs resolves its transport mode via `resolve_mcp_endpoint`. This checks MCP_ENDPOINT (tcp|stdio|socket) and falls back to TCP if unset or invalid. Maintainers should confirm resolver behavior when changing environment defaults.\n\n## Other Notes\n- Ensure .env remains aligned with labs_spec.\n- Deprecated vars such as SYN_SCHEMAS_DIR should not be reintroduced."
        }
      ]
    }
  ],
  "constraints": {
    "rules": [
      "No new dependencies.",
      "Runtime changes limited to deprecation warning emission.",
      "Docs must clearly mention resolver fallback and SYN_SCHEMAS_DIR policy.",
      "Edits confined to listed files."
    ]
  },
  "exit_criteria": [
    "labs/mcp_stdio.py emits a single logger.warning when SYN_SCHEMAS_DIR is set under STDIO.",
    ".env sample marks SYN_SCHEMAS_DIR as deprecated and STDIO-only.",
    "docs/process.md (or maintainer doc) explicitly references resolve_mcp_endpoint and fallback behavior.",
    "CI green with no regressions.",
    "Audit rerun shows zero Missing/Divergent rows for v0.3.3."
  ]
}

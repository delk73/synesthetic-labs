{
  "task": "Align SYN_SCHEMAS_DIR handling with v0.3.3 spec",
  "objective": "Update docs, env samples, and tests so SYN_SCHEMAS_DIR is marked deprecated and STDIO-only, with a regression test for the warning emission.",
  "changes": [
    {
      "id": "readme_update",
      "description": "Clarify in README that SYN_SCHEMAS_DIR is deprecated and only applies to STDIO adapters.",
      "edits": [
        {
          "file": "README.md",
          "pattern": "SYN_SCHEMAS_DIR.*deprecated.*",
          "multiple": true,
          "replacement": "SYN_SCHEMAS_DIR (deprecated, STDIO-only): If set, forwards schemas to the STDIO adapter. Ignored for TCP and socket transports."
        }
      ]
    },
    {
      "id": "env_update",
      "description": "Revise .example.env to mark SYN_SCHEMAS_DIR as deprecated/STDIO-only.",
      "edits": [
        {
          "file": ".example.env",
          "pattern": "SYN_SCHEMAS_DIR=.*",
          "multiple": true,
          "replacement": "# Deprecated: only used for STDIO adapter; ignored for TCP/socket\n# SYN_SCHEMAS_DIR=/abs/path/to/schemas"
        }
      ]
    },
    {
      "id": "test_warning_emission",
      "description": "Introduce regression test for SYN_SCHEMAS_DIR deprecation warning under STDIO.",
      "edits": [
        {
          "file": "tests/test_critic.py",
          "pattern": ".*",
          "multiple": true,
          "replacement": "import pytest, os\nfrom labs import mcp_stdio\n\n\ndef test_schemas_dir_emits_single_warning(monkeypatch, caplog):\n    monkeypatch.setenv(\"MCP_ENDPOINT\", \"stdio\")\n    monkeypatch.setenv(\"SYN_SCHEMAS_DIR\", \"/tmp/fake_schemas\")\n    caplog.clear()\n    _ = mcp_stdio.build_validator_from_env()\n    warnings = [r for r in caplog.records if \"SYN_SCHEMAS_DIR is deprecated\" in r.message]\n    assert len(warnings) == 1\n    assert \"STDIO\" in warnings[0].message"
        }
      ]
    }
  ],
  "constraints": {
    "rules": [
      "Do not alter runtime behavior beyond emitting the existing warning once.",
      "Docs must clearly state STDIO-only deprecation.",
      "Tests must be deterministic and CI-safe.",
      "Edits confined to listed files."
    ]
  },
  "exit_criteria": [
    "README explicitly states SYN_SCHEMAS_DIR is STDIO-only.",
    ".example.env marks SYN_SCHEMAS_DIR deprecated/STDIO-only.",
    "Unit test asserts a single warning emission with caplog.",
    "CI passes with no regressions.",
    "Audit rerun shows no divergences for SYN_SCHEMAS_DIR handling."
  ]
}

{
  "task": "Load and validate environment variables at CLI startup",
  "objective": "Ensure the CLI automatically loads .env, validates presence of LABS_EXTERNAL_LIVE, GEMINI_API_KEY, and OPENAI_API_KEY, and logs warnings if missing. This brings runtime into full compliance with v0.3.4 External Environment Handling requirements.",
  "changes": [
    {
      "id": "cli_env_preload",
      "description": "Preload .env and validate critical env vars before CLI command parsing.",
      "edits": [
        {
          "file": "labs/cli.py",
          "pattern": "^import ",
          "multiple": false,
          "replacement": "import os\nimport logging\nfrom dotenv import load_dotenv\n\n# --- Preload .env early ---\nload_dotenv(dotenv_path='.env', override=False)\n\n# --- Validate required env vars ---\nfor key in ['LABS_EXTERNAL_LIVE', 'GEMINI_API_KEY', 'OPENAI_API_KEY']:\n    if not os.getenv(key):\n        logging.warning(f'Missing environment variable {key}; falling back to mock mode.')\n\nimport "
        }
      ]
    }
  ],
  "constraints": {
    "rules": [
      "Do not add new dependencies; python-dotenv already required",
      "Must not alter CLI argument parsing or generator behavior",
      "Only warn on missing vars, do not raise errors",
      "Load .env before any subcommand executes"
    ]
  },
  "exit_criteria": [
    "Running CLI without exported vars prints clear warnings",
    ".env values are visible via os.getenv() in subprocesses",
    "External generators switch to live mode when LABS_EXTERNAL_LIVE=1",
    "No change to strict/relaxed validation flow"
  ]
}
